(()=>{function e(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}self.onmessage=function(e){var t=e.data,n=t.dataToProcess,a=t.options,o=r(n,a);self.postMessage(o)};var r=function(e,r){var t=e.audienceSegments,n=e.categories,a=e.impressionEventIds,o=e.keyValues,s=e.keywords,c=r.hostname,u=r.referrer||"",f=r.urlPath;return i({audienceSegments:t,categories:n,impressionEventIds:a,keyValues:o,keywords:s,extractedHostname:c,extractedReferrer:u,extracteUrlPath:f})},t=["meta_keywords","content_categories","page_domains","url_paths","referrer_domains","ops_campaigns","user_profiles"],n=function(e){var r=function(e){return e.toLowerCase().replace("www.","")};return"string"==typeof e?r(e):Array.isArray(e)?e.map((function(e){return r(e)})):e},a=function(r,t){var n,a=function(r,t){var n="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array.isArray(r)||(n=function(r,t){if(r){if("string"==typeof r)return e(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){n&&(r=n);var a=0,o=function(){};return{s:o,n:function(){return a>=r.length?{done:!0}:{done:!1,value:r[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){n=n.call(r)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw s}}}}(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(s(o,t))return!0}}catch(e){a.e(e)}finally{a.f()}return!1},o=function(e,r){return Object.keys(e).some((function(t){return Object.keys(e[t]).some((function(n){return!!r[n]&&(Array.isArray(e[t][n])?e[t][n].some((function(e){return s(e,r[n])})):r[n]&&s(e[t][n],r[n]))}))}))},s=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var n=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(r);n=n.replace(/_/g,"[^0-9A-Za-zÀ-ÖØ-öø-ɏḀ-ỿ]?"),!t||n.startsWith("~")||n.endsWith("~")?n=(n=n.startsWith("~")?n.slice(1):"(^| )".concat(n)).endsWith("~")?n.slice(0,-1):"".concat(n,"( |$)"):(n.startsWith("~")&&n.endsWith("~")&&(n=n.slice(1,-1)),n="(^|\\.)".concat(n,"$"));var a=new RegExp(n);return e.match(a)}catch(e){return console.warn("Error parsing regular expression",{message:e.message,stack:e.stack}),!1}},i=function(e){var r,i=e.audienceSegments,c=void 0===i?[]:i,u=e.categories,f=void 0===u?[]:u,l=e.keywords,m=void 0===l?[]:l,d=e.impressionEventIds,g=void 0===d?[]:d,p=e.keyValues,v=void 0===p?{}:p,y=e.extractedHostname,h=e.extractedReferrer,w=e.extracteUrlPath,_=n(y||""),A=n(function(e){var r=e;try{r=/\/\/(.[^/]+)/.exec(e)[1]}catch(e){}return r}(h||"")),b=n(w||""),k=[],S=[];return r=c,Array.isArray(r)&&r.length>0?(c.forEach((function(e){for(var r=!0,i=e.id,c=e.definition,u=c.length,l=0;l<u;l++){var d=c[l],p=d.group,y=d.values,h=d.operator;if(t.includes(p)){if(0!==l&&r&&"OR"===h){k.push("".concat(i));break}(r||("OR"===h&&(r=!0),"AND"!==h))&&("meta_keywords"===p?r=y.some((function(e){var r=n(e);return a(m,r)})):"content_categories"===p?r=y.some((function(e){return f.includes(n(e))})):"page_domains"===p?r=y.some((function(e){var r=n(e);return s(_,r,!0)})):"url_paths"===p?r=y.some((function(e){var r=n(e);return s(b,r)})):"referrer_domains"===p?r=y.some((function(e){var r=n(e);return s(A,r,!0)})):"user_profiles"===p?r=y.some((function(e){var r=n(e);return o(v,r)})):"ops_campaigns"===p&&(r=y.some((function(e){return g.includes(n(e))})))&&S.push("".concat(i)),l===u-1&&r&&k.push("".concat(i)))}}})),{matchedSegments:k,campaignSegments:S}):{matchedSegments:k,campaignSegments:S}}})();